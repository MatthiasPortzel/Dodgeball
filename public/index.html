<!DOCTYPE HTML>
<html>
<head>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/player-client-side.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.12/p5.js"></script>
    <title>Code Day Dodgeball</title>
    <style>
    #topTitle{
      font-family: Verdana;
    }
     * { padding: 0; margin: 0; }
     canvas {background: #d9d9d9; display: block; margin: 0 auto;}
   </style>
</head>
<body>
    <center id="topTitle">Code Day - DodgeBall</center>
    <canvas id="defaultCanvas"></canvas>
    <script>
        var canvas = document.getElementById("defaultCanvas");
        var ctx = canvas.getContext("2d");
        window.addEventListener('resize', resizeCanvas, false); //Resizing the canvas to fit the screen
        function resizeCanvas(){
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
          draw();
        }
        resizeCanvas();
        function draw(){ //Put all the drawing stuff in here to avoid size conflicts.

        }
        var username = prompt("What username do you want?"); //Maybe move the username stuff into a function later?
        var socket = io();
        var players, player;
        socket.emit("username input", JSON.stringify({username:username}));
        socket.addEventListener("user joined", function (playerData) {
            var newPlayer = JSON.parse(playerData);
            while (players.length < newPlayer.id) {
                players.push(null);
            }
            players[newPlayer.id] = new Player(newPlayer);
        })
        socket.addEventListener("init", function (data) {
            data = JSON.parse(data);
            players = data.players.map(p => (p ? new Player(p) : null));
            player = new Player(data.player);
        });
        socket.addEventListener("player left", function (data) {
            players[JSON.parse(data).id] = null;
        });
        socket.addEventListener("closing", function () { socket.close(); })
    </script>
</body>
</html>
